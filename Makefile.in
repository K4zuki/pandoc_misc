# USERNAME=
# HOME=

ifeq ($(OS),Windows_NT)
HOME = C:/Users/$(USERNAME)
CABAL = $(HOME)/AppData/Roaming/cabal
EXE:=.exe
WAVEDROM = $(HOME)/AppData/Roaming/npm/wavedrom
# BITFIELD:= $(HOME)/AppData/Roaming/npm/bitfield.cmd
PANTABLE = /c/Program\ Files/Python36/Scripts/pantable.exe
RSVG = $(HOME)/AppData/Roaming/npm/svg2png
GPP = $(HOME)/bin/gpp
PYTHON= python3.exe
FONTDIR = "ExternalLocation = /c"
GPP = $(HOME)/bin/gpp
# MFILTER = $(HOME)/AppData/Roaming/npm/mermaid-filter.cmd
# PUML =
# PUMLFILTER =
IMAGINE = /c/Program\ Files/Python36/Scripts/pandoc-imagine.exe
else
# UNIX common #
CABAL = $(HOME)/.cabal
EXE =
WAVEDROM = /usr/local/bin/wavedrom
PANTABLE = /usr/local/bin/pantable
RSVG = rsvg-convert
PYTHON = python3
IMAGINE = /usr/local/bin/pandoc-imagine
CSV2TABLE= /usr/local/bin/csv2table
ifeq ($(shell uname),Linux)
FONTDIR = "ExternalLocation = $(HOME)/.local/share/fonts/"
GPP = /usr/bin/gpp
else
FONTDIR = "ExternalLocation = /usr/local/texlive/2015basic/texmf-local/"
WAVEDROM = $(HOME)/.nodebrew/current/bin/wavedrom
GPP = /usr/local/bin/gpp
endif
endif

### constant over OSes
PCROSSREF = $(CABAL)/bin/pandoc-crossref$(EXE)
# PANDOC= $(CABAL)/bin/pandoc$(EXE)
# be9957bd https://github.com/pandoc-extras/pandoc-nightly/releases/latest
PANDOC= $(HOME)/bin/pandoc
PANSTYLES= $(HOME)/.pandoc
MISC= $(PANSTYLES)/pandoc_misc
BITFIELD:= $(MISC)/bitfield/bin/bitfield.js

REFERENCE= $(MISC)/ref.docx

SVN=
SVNDIR=

FILTER= $(MISC)/include.py
DOCXPWRTR:= $(MISC)/docxPropertywriter.py
IMAGINEDIR:= pd-images

TEXTEMPLATE = $(MISC)/CJK_xelatex.tex
# TEXTEMPLATE = $(MISC)/../pandoc-latex-template/eisvogel.latex
TEXFLAGS = --template=$(TEXTEMPLATE)
TEXFLAGS += --latex-engine=xelatex
TEXFONTFLAGS = -M documentclass=book
TEXFONTFLAGS += -M localfontdir=$(FONTDIR)
TEXFONTFLAGS += -M fontsize=11
TEXFONTFLAGS += -M papersize=b5paper
TEXFONTFLAGS += -M mainfont=SourceSansPro-Regular
TEXFONTFLAGS += -M sansfont=SourceSansPro-Regular
TEXFONTFLAGS += -M monofont=RictyDiminished-Regular
TEXFONTFLAGS += -M mainlang=Japanese
TEXFONTFLAGS += -M CJKoptions='BoldFont=RictyDiminished-Bold, \
	ItalicFont=RictyDiminished-Oblique, \
	BoldItalicFont=RictyDiminished-BoldOblique'
TEXFONTFLAGS += -M CJKmainfont=RictyDiminished-Regular
TEXFONTFLAGS += -M CJKsansfont=RictyDiminished-Regular
TEXFONTFLAGS += -M CJKmonofont=RictyDiminished-Regular
TEXFONTFLAGS += -M geometry='top=30truemm,bottom=30truemm,left=20truemm,right=20truemm'

# TEXFLAGS += -V lang=en-us
### pandoc flags
PANFLAGS = --read=markdown+east_asian_line_breaks
PANFLAGS += --filter=$(MISC)/panflute/rotateimg.py
PANFLAGS += --filter=$(MISC)/panflute/include.py
PANFLAGS += --filter=$(PANTABLE)
PANFLAGS += --filter=$(PCROSSREF)
PANFLAGS += --filter=$(IMAGINE)
PANFLAGS += --toc
PANFLAGS += --listings
PANFLAGS += --number-sections --highlight-style=pygments
PANFLAGS += -M css=$(MISC)/github_css/github.css
PANFLAGS += -M short-hash=`git rev-parse --short HEAD`
PANFLAGS += -M tables=true
###  for debug  ###
# PANFLAGS += --filter=$(MISC)/panflute/rotate.py
### ### ### ### ###

### GPP flags
GPPFLAGS = -H +c "<!--" "-->"
GPPFLAGS += -I$(MDDIR)
GPPFLAGS += -I$(DATADIR)
GPPFLAGS += -I$(TARGETDIR)
GPPFLAGS += -Ipanflute

###  default directories set; otherwise images/ directory cleaned by make-clean
MDDIR= markdown
DATADIR:= data
TARGETDIR:= Out
IMAGEDIR:= images
WAVEDIR:= waves
BITDIR:= bitfields
BIT16DIR:= bitfield16
MFILTDIR:= mermaid-filter
PREFIX= .

### default source and target file names
INPUT:= TITLE.md
TARGET:= TARGET
